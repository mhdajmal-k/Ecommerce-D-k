<style>
    .category-button {
        background-color: #095a40;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        margin-bottom: 10px;
    }

    .category-button:hover {
        background-color: #095a40;
        color: white;
    }
    .chart-container {
    width: 50%; /* Each chart takes up 50% of the row */
    display: inline-block; /* Display charts inline */
    box-sizing: border-box; /* Include padding and border in width */
    padding: 10px; /* Optional: Add some padding around the chart */
    text-align: center; /* Optional: Center the charts horizontally */
}

</style>
<%- include ("../partilas/admin") %>
    <section class="content-main">
        <div class="content-header">
            <div>
                <h2 class="content-title card-title">Dashboard </h2>
                <p>Whole data about your business here</p>
            </div>
            <div>
                <a href="#" class="btn btn-primary"><i class="text-muted material-icons md-post_add"></i>Create
                    report</a>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-3">
                <div class="card card-body mb-4">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-primary-light"><i
                                class="text-primary material-icons md-monetization_on"></i></span>
                        <div class="text">
                            <h6 class="mb-1 card-title">Revenue</h6>
                            <span>
                                <% if (locals.totalSale&& locals.totalSale.length> 0) { %>
                                    RS <%= totalSale[0].total %>
                                        <span class="text-sm">
                                            Shipping fees are not included
                                        </span>
                                        <% } else { %>
                                            <P>NO SALES </P>
                                            <% } %>
                            </span>
                        </div>
                    </article>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card card-body mb-4">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-success-light"><i
                                class="text-success material-icons md-local_shipping"></i></span>
                        <div class="text">
                            <h6 class="mb-1 card-title">Orders</h6> <span>
                                <% if (locals.orders) { %>
                                    <%= orders %>
                                        <span class="text-sm">
                                            Excluding orders in transit
                                        </span>
                                        <% } else { %>
                                            No Order Yet
                                            <% } %>
                            </span>
                        </div>
                    </article>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card card-body mb-4 ">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-warning-light"><i
                                class="text-warning material-icons md-qr_code"></i></span>
                        <div class="text">
                            <p class="mb-1 ">Products</p> <span>
                                <% if (locals.productCont) { %>

                                    <% } %>
                                        <%= productCont %>
                            </span>
                            <span class="text-sm">
                                In <%=categories%> Categories
                            </span>
                        </div>
                    </article>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card card-body mb-4">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-info-light"><i
                                class="text-info material-icons md-shopping_basket"></i></span>
                        <div class="text">
                            <h6 class="mb-1 card-title">Monthly sale</h6> <span> Rs
                                <% if (locals.monthlySales.length>0) { %>

                                    <%=monthlySales[0].totalSales%>
                            </span>
                            <% } %>
                                <span class="text-sm">
                                    Based in your local time.
                                </span>
                        </div>
                    </article>
                </div>
            </div>
        </div>
       
     

            
            <div class="row">
                <div class="chart-container">
                    <canvas id="myChart" style="max-width: 700px"></canvas>
                </div>
                <p class="text-primary TEXT-CENTER" id="MONTHLY">SHOW MONTHLY ORDERS</p>
                <div class="chart-container2" style="display: none;">
                    <canvas id="myChart2" style="max-width: 700px"></canvas>
                </div>
                
            </div>
             <canvas id="myChart11"></canvas>
      
        <div class="container mt-50">
            <h2 style="text-align: center;">Top Selling Products</h2>
            <div class="table-responsive">
                <table class="table table-bordered table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Product ID</th>
                            <th>Product Name</th>
                            <th>Image</th>
                            <th>Color</th>
                            <th>Price</th>
                            <th>Selling Price</th>
                            <th>Category ID</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Loop through productDetails array and generate table rows -->
                        <% if (locals.productDetails.length>0) { %>

                            <% productDetails.forEach(product=> { %>
                                <tr>
                                    <td>
                                        <%= product.productId %>
                                    </td>
                                    <td>
                                        <%= product.productName %>
                                    </td>
                                    <td><img src="/uploads/products/<%= product.image[1] %>" class="img-thumbnail"
                                            alt="Product Image" style="max-width: 50px; height: auto;"></td>
                                    <td>
                                        <%= product.color %>
                                    </td>
                                    <td>
                                        <%= product.price %>
                                    </td>
                                    <td>
                                        <%= product.sellingPrice %>
                                    </td>
                                    <td>
                                        <%= product.categoryId.categoryTitle %>
                                    </td>
                                </tr>
                                <% }); %>
                                    <% } else { %>
                                        <TD>No Data available</TD>
                                        <% } %>

                    </tbody>
                </table>
            </div>
        </div>
        <div class="container" style="margin-top: 10px;">
            <h1 class="mt-4" style="text-align: center; ">Top Category</h1>

            <div class="row container">


                <div style="display: flex; flex-wrap: wrap; justify-content: space-evenly; margin-top: 10px;">
                    <% if (topCategory.length>0) { %>
                        <% topCategory.forEach(element=> { %>
                            <div class="card-title bg-6 bg-info-light container  "
                                style="border-radius:5px ; width: auto;">
                                <%= element.categoryTitle %>
                            </div>
                            <% }) %>
                                <% } else { %>
                                    <p>NO DATA available</p>
                                    <% } %>
                </div>

            </div>
        </div>





    </section> <!-- content-main end// -->
    <footer class="main-footer font-xs">
        <div class="row pb-30 pt-15">
            <div class="col-sm-6">
                <script>
                    document.write(new Date().getFullYear())
                </script> Â©, Duck & wave - HTML Ecommerce Template .
            </div>
            <div class="col-sm-6">
                <div class="text-sm-end">
                    All rights reserved
                </div>
            </div>
        </div>
    </footer>
    </main>
    <script src="/asset/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/asset/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/asset/js/vendors/select2.min.js"></script>
    <script src="/asset/js/vendors/perfect-scrollbar.js"></script>
    <script src="/asset/js/vendors/jquery.fullscreen.min.js"></script>
    </script>
    <!-- Main Script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="/asset/js/main.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            $.ajax({
                url: "/admin/dashboard",
                method: "POST",
                success: function (response) {
                    const ctx = document.getElementById('myChart');

                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Object.keys(response.dataCurrentWeek), // Use the keys from the response as labels
                            datasets: [{
                                label: 'Order Count',
                                data: Object.values(response.dataCurrentWeek), // Use the values from the response as data
                                borderWidth: 1,
                                backgroundColor: 'rgba(255, 99, 132, 0.2)', // Set background color for bars
                                borderColor: 'rgba(255, 99, 132, 1)', // Set border color for bars
                                hoverBackgroundColor: 'rgba(255, 99, 132, 0.4)', // Set hover background color for bars
                                hoverBorderColor: 'rgba(255, 99, 132, 1)' // Set hover border color for bars
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                    const ctx2 = document.getElementById('myChart2');

                    new Chart(ctx2, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(response.dataCurrentYear),
                            datasets: [{
                                label: '# monthly Orders',
                                data: Object.values(response.dataCurrentYear),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                    const ctx1 = document.getElementById('myChart11');

                    new Chart(ctx1, {
                        type: 'line',
                        data: {
                            labels: Object.keys(response.revenueCurrentYear),
                            datasets: [{
                                label: '# monthly sales',
                                data: Object.values(response.revenueCurrentYear),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });

                },

                error: function (xhr) {
                    console.log("xhr : ", xhr);
                }
            });
        });

       
        const MONTHLY = document.getElementById("MONTHLY");
    const chartContainer = document.querySelector(".chart-container2");

    MONTHLY.addEventListener("click", () => {
        if (chartContainer.style.display === "none") {
            chartContainer.style.display = "block";
            // Code to render the chart goes here
        } else {
            chartContainer.style.display = "none";
        }
    });


    </script>






    </body>

    </html>